/* BTEQ Script to set up comprehensive test tables for Teradata-Trino connector validation */
/* This creates tables covering all major Teradata data types */

.LOGON 192.168.137.129/dbc,dbc;

DATABASE TrinoExport;

/* ============================================================ */
/* Drop existing test tables if they exist                      */
/* ============================================================ */
.SET ERRORLEVEL 3807 SEVERITY 0

DROP TABLE test_integer_types;
DROP TABLE test_decimal_types;
DROP TABLE test_float_types;
DROP TABLE test_char_types;
DROP TABLE test_datetime_types;
DROP TABLE test_null_handling;
DROP TABLE test_edge_cases;
DROP TABLE test_join_fact;
DROP TABLE test_join_dim;

.SET ERRORLEVEL 3807 SEVERITY 8

/* ============================================================ */
/* Test Table 1: Integer Types                                  */
/* ============================================================ */
CREATE TABLE test_integer_types (
    test_id INTEGER NOT NULL,
    col_byteint BYTEINT,
    col_smallint SMALLINT,
    col_integer INTEGER,
    col_bigint BIGINT,
    description VARCHAR(100)
) PRIMARY INDEX (test_id);

INSERT INTO test_integer_types VALUES (1, 0, 0, 0, 0, 'Zero values');
INSERT INTO test_integer_types VALUES (2, 1, 1, 1, 1, 'One values');
INSERT INTO test_integer_types VALUES (3, -1, -1, -1, -1, 'Negative one');
INSERT INTO test_integer_types VALUES (4, 127, 32767, 2147483647, 9223372036854775807, 'Max positive');
INSERT INTO test_integer_types VALUES (5, -128, -32768, -2147483648, -9223372036854775808, 'Max negative');
INSERT INTO test_integer_types VALUES (6, 42, 1234, 123456789, 9876543210123, 'Random values');

/* ============================================================ */
/* Test Table 2: Decimal Types                                  */
/* ============================================================ */
CREATE TABLE test_decimal_types (
    test_id INTEGER NOT NULL,
    col_dec_2_0 DECIMAL(2,0),
    col_dec_5_2 DECIMAL(5,2),
    col_dec_10_4 DECIMAL(10,4),
    col_dec_18_6 DECIMAL(18,6),
    col_dec_38_10 DECIMAL(38,10),
    description VARCHAR(100)
) PRIMARY INDEX (test_id);

INSERT INTO test_decimal_types VALUES (1, 0, 0.00, 0.0000, 0.000000, 0.0000000000, 'Zero values');
INSERT INTO test_decimal_types VALUES (2, 1, 1.00, 1.0000, 1.000000, 1.0000000000, 'One values');
INSERT INTO test_decimal_types VALUES (3, -1, -1.00, -1.0000, -1.000000, -1.0000000000, 'Negative one');
INSERT INTO test_decimal_types VALUES (4, 99, 999.99, 999999.9999, 999999999999.999999, 99999999999999999999999999.9999999999, 'Max precision');
INSERT INTO test_decimal_types VALUES (5, 25, 123.45, 1234.5678, 123456.789012, 12345678901234567890.1234567890, 'Random values');
INSERT INTO test_decimal_types VALUES (6, -50, -456.78, -9876.5432, -654321.123456, -98765432109876543210.9876543210, 'Negative random');

/* ============================================================ */
/* Test Table 3: Float/Double Types                             */
/* ============================================================ */
CREATE TABLE test_float_types (
    test_id INTEGER NOT NULL,
    col_float FLOAT,
    col_real REAL,
    col_double DOUBLE PRECISION,
    description VARCHAR(100)
) PRIMARY INDEX (test_id);

INSERT INTO test_float_types VALUES (1, 0.0, 0.0, 0.0, 'Zero');
INSERT INTO test_float_types VALUES (2, 1.0, 1.0, 1.0, 'One');
INSERT INTO test_float_types VALUES (3, -1.0, -1.0, -1.0, 'Negative one');
INSERT INTO test_float_types VALUES (4, 3.14159265359, 3.14159265359, 3.14159265358979323846, 'Pi');
INSERT INTO test_float_types VALUES (5, 2.71828182845, 2.71828182845, 2.71828182845904523536, 'E');
INSERT INTO test_float_types VALUES (6, 1.23E10, 1.23E10, 1.23E15, 'Scientific notation');
INSERT INTO test_float_types VALUES (7, -9.87E-5, -9.87E-5, -9.87654321E-10, 'Small negative');

/* ============================================================ */
/* Test Table 4: Character Types                                */
/* ============================================================ */
CREATE TABLE test_char_types (
    test_id INTEGER NOT NULL,
    col_char_10 CHAR(10),
    col_varchar_50 VARCHAR(50),
    col_varchar_255 VARCHAR(255),
    description VARCHAR(100)
) PRIMARY INDEX (test_id);

INSERT INTO test_char_types VALUES (1, 'Hello     ', 'Hello World', 'This is a longer string for testing', 'Basic ASCII');
INSERT INTO test_char_types VALUES (2, '          ', '', '', 'Empty/spaces');
INSERT INTO test_char_types VALUES (3, 'ABC123    ', 'ABC123!@#$%', 'Special chars: !@#$%^&*()_+-=[]{}|;:,.<>?', 'Special chars');
INSERT INTO test_char_types VALUES (4, 'Test''s    ', 'It''s a test', 'Single quote: '' and more text', 'Single quotes');
INSERT INTO test_char_types VALUES (5, '1234567890', 'Numbers in varchar: 12345', '0123456789 repeated text', 'Numeric strings');

/* ============================================================ */
/* Test Table 5: Date/Time Types                                */
/* ============================================================ */
CREATE TABLE test_datetime_types (
    test_id INTEGER NOT NULL,
    col_date DATE,
    col_time TIME,
    col_timestamp TIMESTAMP,
    description VARCHAR(100)
) PRIMARY INDEX (test_id);

INSERT INTO test_datetime_types VALUES (1, DATE '2024-01-01', TIME '00:00:00', TIMESTAMP '2024-01-01 00:00:00', 'New Year midnight');
INSERT INTO test_datetime_types VALUES (2, DATE '2024-12-31', TIME '23:59:59', TIMESTAMP '2024-12-31 23:59:59', 'End of year');
INSERT INTO test_datetime_types VALUES (3, DATE '2000-02-29', TIME '12:30:45', TIMESTAMP '2000-02-29 12:30:45', 'Leap year date');
INSERT INTO test_datetime_types VALUES (4, DATE '1970-01-01', TIME '00:00:00', TIMESTAMP '1970-01-01 00:00:00', 'Unix epoch');
INSERT INTO test_datetime_types VALUES (5, DATE '2024-06-15', TIME '14:25:36', TIMESTAMP '2024-06-15 14:25:36.123456', 'With microseconds');

/* ============================================================ */
/* Test Table 6: NULL Handling                                  */
/* ============================================================ */
CREATE TABLE test_null_handling (
    test_id INTEGER NOT NULL,
    col_int INTEGER,
    col_decimal DECIMAL(10,2),
    col_varchar VARCHAR(50),
    col_date DATE,
    description VARCHAR(100)
) PRIMARY INDEX (test_id);

INSERT INTO test_null_handling VALUES (1, NULL, NULL, NULL, NULL, 'All NULLs');
INSERT INTO test_null_handling VALUES (2, 100, 123.45, 'Not null', DATE '2024-01-15', 'No NULLs');
INSERT INTO test_null_handling VALUES (3, NULL, 999.99, 'Partial null', DATE '2024-02-20', 'Int is NULL');
INSERT INTO test_null_handling VALUES (4, 200, NULL, 'Partial null', DATE '2024-03-25', 'Decimal is NULL');
INSERT INTO test_null_handling VALUES (5, 300, 456.78, NULL, DATE '2024-04-30', 'Varchar is NULL');
INSERT INTO test_null_handling VALUES (6, 400, 789.01, 'Date null', NULL, 'Date is NULL');

/* ============================================================ */
/* Test Table 7: Edge Cases                                     */
/* ============================================================ */
CREATE TABLE test_edge_cases (
    test_id INTEGER NOT NULL,
    col_int INTEGER,
    col_dec DECIMAL(7,2),
    col_varchar VARCHAR(100),
    description VARCHAR(100)
) PRIMARY INDEX (test_id);

INSERT INTO test_edge_cases VALUES (1, 0, 0.01, 'Minimum decimal', 'Small decimal');
INSERT INTO test_edge_cases VALUES (2, 1, 0.00, 'Zero decimal', 'Zero decimal value');
INSERT INTO test_edge_cases VALUES (3, 2, -0.01, 'Negative small', 'Negative small decimal');
INSERT INTO test_edge_cases VALUES (4, 3, 99999.99, 'Max for 7,2', 'Max value for precision');
INSERT INTO test_edge_cases VALUES (5, 4, -99999.99, 'Min for 7,2', 'Min value for precision');

/* ============================================================ */
/* Test Tables 8 & 9: JOIN Testing                              */
/* ============================================================ */
CREATE TABLE test_join_dim (
    dim_id INTEGER NOT NULL,
    dim_name VARCHAR(50),
    dim_category VARCHAR(20)
) PRIMARY INDEX (dim_id);

CREATE TABLE test_join_fact (
    fact_id INTEGER NOT NULL,
    dim_id INTEGER,
    fact_value DECIMAL(10,2),
    fact_date DATE
) PRIMARY INDEX (fact_id);

INSERT INTO test_join_dim VALUES (1, 'Category A', 'Type1');
INSERT INTO test_join_dim VALUES (2, 'Category B', 'Type1');
INSERT INTO test_join_dim VALUES (3, 'Category C', 'Type2');
INSERT INTO test_join_dim VALUES (4, 'Category D', 'Type2');
INSERT INTO test_join_dim VALUES (5, 'Category E', 'Type3');

INSERT INTO test_join_fact VALUES (101, 1, 100.50, DATE '2024-01-10');
INSERT INTO test_join_fact VALUES (102, 1, 200.75, DATE '2024-01-15');
INSERT INTO test_join_fact VALUES (103, 2, 150.25, DATE '2024-02-10');
INSERT INTO test_join_fact VALUES (104, 2, 175.00, DATE '2024-02-15');
INSERT INTO test_join_fact VALUES (105, 3, 300.00, DATE '2024-03-10');
INSERT INTO test_join_fact VALUES (106, 4, 250.50, DATE '2024-03-15');
INSERT INTO test_join_fact VALUES (107, 5, 400.00, DATE '2024-04-10');
INSERT INTO test_join_fact VALUES (108, 1, 125.25, DATE '2024-04-15');

/* ============================================================ */
/* Test Table 10: Unicode Characters                            */
/* ============================================================ */
.SET ERRORLEVEL 3807 SEVERITY 0
DROP TABLE test_unicode;
.SET ERRORLEVEL 3807 SEVERITY 8

CREATE TABLE test_unicode (
    test_id INTEGER NOT NULL,
    col_unicode VARCHAR(200) CHARACTER SET UNICODE,
    col_latin VARCHAR(100) CHARACTER SET LATIN,
    description VARCHAR(100)
) PRIMARY INDEX (test_id);

/* Chinese characters */
INSERT INTO test_unicode VALUES (1, '‰∏≠ÊñáÊµãËØï', 'Chinese test', 'Chinese chars');
/* Thai characters */
INSERT INTO test_unicode VALUES (2, '‡∏ó‡∏î‡∏™‡∏≠‡∏ö', 'Thai test', 'Thai chars');
/* Japanese characters */
INSERT INTO test_unicode VALUES (3, 'Êó•Êú¨Ë™û', 'Japanese test', 'Japanese');
/* Korean characters */
INSERT INTO test_unicode VALUES (4, 'ÌïúÍµ≠Ïñ¥', 'Korean test', 'Korean');
/* Emoji */
INSERT INTO test_unicode VALUES (5, 'Hello üåç', 'Latin only', 'Basic ASCII mixed');
/* Mixed Unicode and ASCII */
INSERT INTO test_unicode VALUES (6, 'Test ‰∏≠Êñá Mix', 'Mixed test', 'Mixed');

/* ============================================================ */
/* Test Table 11: Extended Date/Time Edge Cases                 */
/* ============================================================ */
.SET ERRORLEVEL 3807 SEVERITY 0
DROP TABLE test_datetime_edge;
.SET ERRORLEVEL 3807 SEVERITY 8

CREATE TABLE test_datetime_edge (
    test_id INTEGER NOT NULL,
    col_date DATE,
    col_time TIME(6),
    col_timestamp TIMESTAMP(6),
    description VARCHAR(100)
) PRIMARY INDEX (test_id);

/* Note: Teradata DATE range is 0001-01-01 to 9999-12-31 */
/* Internal storage uses year offset from 1900 */
INSERT INTO test_datetime_edge VALUES (1, DATE '0001-01-01', TIME '00:00:00', TIMESTAMP '0001-01-01 00:00:00', 'Earliest date');
INSERT INTO test_datetime_edge VALUES (2, DATE '1899-12-31', TIME '23:59:59', TIMESTAMP '1899-12-31 23:59:59', 'Before 1900 boundary');
INSERT INTO test_datetime_edge VALUES (3, DATE '1900-01-01', TIME '00:00:00', TIMESTAMP '1900-01-01 00:00:00', 'Teradata epoch (1900)');
INSERT INTO test_datetime_edge VALUES (4, DATE '2099-12-31', TIME '12:00:00', TIMESTAMP '2099-12-31 12:00:00', 'Future date');
INSERT INTO test_datetime_edge VALUES (5, DATE '2024-02-29', TIME '06:30:45.123456', TIMESTAMP '2024-02-29 06:30:45.123456', 'Leap year with microseconds');

/* ============================================================ */
/* Test Table 12: Pushdown Filter Testing                       */
/* ============================================================ */
.SET ERRORLEVEL 3807 SEVERITY 0
DROP TABLE test_pushdown;
.SET ERRORLEVEL 3807 SEVERITY 8

CREATE TABLE test_pushdown (
    test_id INTEGER NOT NULL,
    filter_int INTEGER,
    filter_bigint BIGINT,
    filter_decimal DECIMAL(10,2),
    filter_varchar VARCHAR(50),
    filter_date DATE,
    description VARCHAR(100)
) PRIMARY INDEX (test_id);

/* Create rows with distinct filter values for each type */
INSERT INTO test_pushdown VALUES (1, 100, 1000000000000, 123.45, 'alpha', DATE '2024-01-15', 'Row 1');
INSERT INTO test_pushdown VALUES (2, 200, 2000000000000, 234.56, 'beta', DATE '2024-02-15', 'Row 2');
INSERT INTO test_pushdown VALUES (3, 300, 3000000000000, 345.67, 'gamma', DATE '2024-03-15', 'Row 3');
INSERT INTO test_pushdown VALUES (4, 400, 4000000000000, 456.78, 'delta', DATE '2024-04-15', 'Row 4');
INSERT INTO test_pushdown VALUES (5, 500, 5000000000000, 567.89, 'epsilon', DATE '2024-05-15', 'Row 5');
INSERT INTO test_pushdown VALUES (6, 100, 1000000000000, 123.45, 'alpha', DATE '2024-01-15', 'Duplicate of Row 1');
INSERT INTO test_pushdown VALUES (7, 200, 2000000000000, 234.56, 'beta', DATE '2024-02-15', 'Duplicate of Row 2');
INSERT INTO test_pushdown VALUES (8, 300, 3000000000000, 345.67, 'gamma', DATE '2024-03-15', 'Duplicate of Row 3');

/* ============================================================ */
/* Verify data was inserted                                     */
/* ============================================================ */
SELECT 'test_integer_types', COUNT(*) FROM test_integer_types;
SELECT 'test_decimal_types', COUNT(*) FROM test_decimal_types;
SELECT 'test_float_types', COUNT(*) FROM test_float_types;
SELECT 'test_char_types', COUNT(*) FROM test_char_types;
SELECT 'test_datetime_types', COUNT(*) FROM test_datetime_types;
SELECT 'test_null_handling', COUNT(*) FROM test_null_handling;
SELECT 'test_edge_cases', COUNT(*) FROM test_edge_cases;
SELECT 'test_join_dim', COUNT(*) FROM test_join_dim;
SELECT 'test_join_fact', COUNT(*) FROM test_join_fact;
SELECT 'test_unicode', COUNT(*) FROM test_unicode;
SELECT 'test_datetime_edge', COUNT(*) FROM test_datetime_edge;
SELECT 'test_pushdown', COUNT(*) FROM test_pushdown;

.LOGOFF;
.EXIT;

